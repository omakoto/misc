#!/bin/bash

# Read from the clipboard, and try to fullpathify tokens
# using "recent-dirs", and use fzf to pick one(s)

# Also, if there's an env bariable that maches the prefix, show that as a candidate too.

set -e
. mutil.sh

files=$(cb | perl -pe 's!\s+$!!' | tr -s ' \t' '\n')

if [[ "$files" == "" ]] ;then
  exit 0
fi

echo "$files" | while read -r file; do
  {
    recent-dirs | head -50 | while read -r dir ; do
      # Show original
      echo "$file (ORIGINAL)"
      if [[ "$file" = /* ]] ; then
        # fullpath, just print
        echo "$file"
        continue
      fi
      full="$dir$file"
      if [[ -e "$full" ]] ; then
        echo "$full"
        continue
      fi
    done | global-unique | replace-with-env  | fzf -m -0 -1 --tac | sed -e 's/(ORIGINAL)$//'
  }
done
