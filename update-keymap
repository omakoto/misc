#!/bin/bash

# Switch the keymap depending on the device and the connected keyboard.

# Also update ~/.chromedpi too.

set -e
. mutil.sh

medir="${0%/*}"

if iswsl ; then
  echo "WSL detected. Not updating keymap." 1>&2
  exit 0
fi

sf=1
chrome_dpi="1.5"
rdt_dpi=1.0

case "$(hostname -s)" in
  omakoto-glaptop2) # Dell laptop.
    ee $medir/dell-keymap-custom
    dell-touchscreen-enable 1
    chrome_dpi="2.6"
    rdt_dpi=1.5
    sf=2
    ;;
  x1c7ubu|debian) # X1 carbon gen7 / vmware
    chrome_dpi="2.5"
    sf=2
    ;;
  x1c5deb) # X1 carbon gen5
    chrome_dpi="2"
    sf=2
    ;;
esac

if lsusb | grep -q '0853:0111' ; then # Topre keyboard.
  $medir/dell-keymap-reset
  sf=1
fi

ee gsettings set org.cinnamon.desktop.interface scaling-factor $sf
echo "$chrome_dpi" > ~/.chromedpi
echo "$rdt_dpi" > ~/.remote-desktop-dpi

echo "Updated keymap."
