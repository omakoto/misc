#!/bin/bash

. mutil.sh

adb=0

eval "$(getopt.pl -Nx '
a|adb adb=1 # Complete with android device files.
' "$@")"

token="$(readline-current-token -f)"

completed=$(
    {
      # Android device files
      bash-fzf-complete-current-token-android-helper "${token}"

      # Android modules
      android-module-list -q

      # Filenames in recent logs
      zenlog-recent-files -d

      # Executable files.
      list-commands-in-path

      # Local files files
      dir="$token"
      if ! [[ -d "$dir" ]] ; then
        dir="$(dirname "$dir")"
      fi
      find "${dir:-.}" -type f
    } 2>/dev/null |
    fzf-to-args -q "$token" -m --preview='preview-file {}'
    )

if [[ -n "$completed" ]] ; then
  readline-replace $completed
fi
