#!/bin/bash

. mutil.sh

adb=0

eval "$(getopt.pl -Nx '
a|adb adb=1 # Complete with android device files.
' "$@")"

token="$(readline-current-token -f)"

completed=$(
    {
      # Android device files
      bash-fzf-complete-current-token-android-helper "${token}"

      # Android modules
      android-module-list -q

      # Local files
      command ls -p -d "${token}"* 2>/dev/null

      # Filenames in recent logs
      zenlog-recent-files -d

      # Executable files.
      list-commands-in-path

      # All files
      find . -type f
    } 2>/dev/null |
    fzf-to-args -q "$token" -m --preview='preview-file {}'
    )

if [[ -n "$completed" ]] ; then
  readline-replace $completed
fi
