#!/bin/bash

. "${0%/*}/completer-testbase.bash"

# ==============================================================================
# Start tests
# ==============================================================================

test_rg() {
  COMPLETER_IGNORE_CASE=1 assert_comp run_ruby -x $compdir/completer-rg.rb -c "$@"
}

export MOCK_RG_TYPE_LIST='
agda: *.agda, *.lagda
asciidoc: *.adoc, *.asc, *.asciidoc
asm: *.S, *.asm, *.s
awk: *.awk
'

test_rg 1 rg <<'EOF'
'-- '
'-0 '
'-a '
'-A '
aaa/
'--after-context '
'-B '
'--before-context '
'-c '
'-C '
'--case-sensitive '
'--color '
'--colors '
'--column '
'--context '
'--context-separator '
'--count '
'--debug '
'--dfa-size-limit '
'dir2/ '
'-e '
'-E '
'--encoding '
'-f '
'-F '
'--file '
'file1 '
'--files '
'--files-with-matches '
'--files-without-match '
'--fixed-strings '
'--follow '
'-g '
'--glob '
'-h '
'-H '
'--heading '
'--help '
'--hidden '
'-i '
'--iglob '
'--ignore-case '
'--ignore-file '
'--invert-match '
'-j '
'-l '
'-L '
'--line-number '
'--line-regexp '
'-m '
'-M '
'--max-columns '
'--max-count '
'--maxdepth '
'--max-filesize '
'--mmap '
'-n '
'-N '
'--no-filename '
'--no-heading '
'--no-ignore '
'--no-ignore-parent '
'--no-ignore-vcs '
'--no-line-number '
'--no-messages '
'--no-mmap '
'--null '
'-o '
'--only-matching '
'-p '
'--path-separator '
'--pretty '
'-q '
'--quiet '
'-r '
'--regexp '
'--regex-size-limit '
'--replace '
'-s '
'-S '
'--smart-case '
'--sort-files '
'-t '
'-T '
'--text '
'--threads '
'--type '
'--type-add '
'--type-clear '
'--type-list '
'--type-not '
'-u '
'--unrestricted '
'-v '
'-V '
'--version '
'--vimgrep '
'-w '
'--with-filename '
'--word-regexp '
'-x '
EOF

test_rg 2 rg --help <<'EOF'
EOF

test_rg 2 rg --type-list <<'EOF'
EOF

test_rg 2 rg --type-list <<'EOF'
EOF

# This list shouldn't contain "solo options".
test_rg 2 rg --count <<'EOF'
'-- '
'-0 '
'-a '
'-A '
aaa/
'--after-context '
'-B '
'--before-context '
'-c '
'-C '
'--case-sensitive '
'--color '
'--colors '
'--column '
'--context '
'--context-separator '
'--count '
'--debug '
'--dfa-size-limit '
'dir2/ '
'-e '
'-E '
'--encoding '
'-f '
'-F '
'--file '
'file1 '
'--files '
'--files-with-matches '
'--files-without-match '
'--fixed-strings '
'--follow '
'-g '
'--glob '
'-H '
'--heading '
'--hidden '
'-i '
'--iglob '
'--ignore-case '
'--ignore-file '
'--invert-match '
'-j '
'-l '
'-L '
'--line-number '
'--line-regexp '
'-m '
'-M '
'--max-columns '
'--max-count '
'--maxdepth '
'--max-filesize '
'--mmap '
'-n '
'-N '
'--no-filename '
'--no-heading '
'--no-ignore '
'--no-ignore-parent '
'--no-ignore-vcs '
'--no-line-number '
'--no-messages '
'--no-mmap '
'--null '
'-o '
'--only-matching '
'-p '
'--path-separator '
'--pretty '
'-q '
'--quiet '
'-r '
'--regexp '
'--regex-size-limit '
'--replace '
'-s '
'-S '
'--smart-case '
'--sort-files '
'-t '
'-T '
'--text '
'--threads '
'--type '
'--type-add '
'--type-clear '
'--type-not '
'-u '
'--unrestricted '
'-v '
'--vimgrep '
'-w '
'--with-filename '
'--word-regexp '
'-x '
EOF

test_rg 2 rg --context <<'EOF'
'0 '
'1 '
'2 '
'3 '
'4 '
'5 '
'6 '
'7 '
'8 '
'9 '
EOF

test_rg 2 rg --color <<'EOF'
'always '
'auto '
'never '
EOF

test_rg 2 rg --colors <<'EOF'
EOF

test_rg 2 rg --encoding <<'EOF'
'utf-8 '
EOF

test_rg 2 rg --file <<'EOF'
aaa/
'dir2/ '
'file1 '
EOF

test_rg 2 rg --file ../ <<'EOF'
'../.aa1 '
'../aa1 '
'../.aa2 '
'../aa2 '
'../.bb1 '
'../bb1 '
../.completer/
../ddd1/
../ddd2/
'../zzz/ '
EOF

test_rg 3 rg --file /dev/null --c <<'EOF'
'--case-sensitive '
'--color '
'--colors '
'--column '
'--context '
'--context-separator '
'--count '
EOF

test_rg 2 rg -- <<'EOF'
aaa/
'dir2/ '
'file1 '
EOF

test_rg 2 rg --type <<'EOF'
'agda '
'asciidoc '
'asm '
'awk '
EOF

done_testing
