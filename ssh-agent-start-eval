#!/bin/bash

. mutil.sh

if [[ "$CHROME_REMOTE_DESKTOP_SESSION" != "" ]] ; then
	exit 0
fi

if [[ $(hostname -s) == "omakoto-ct1" ]] ; then
	exit 0
fi

is_ssh_setup() {
	if [[ -n "$SSH_AUTH_SOCK" ]] ; then
		if ! [[ -e "$SSH_AUTH_SOCK" ]] ; then
			echo "SSH_AUTH_SOCK doesn't exist." 1>&2
			return 1
		fi
	fi

	if [[ -n "$SSH_AGENT_PID" ]] ; then
		echo "SSH_AGENT_PID already set." 1>&2
		return 0
	fi
	return 0
}

if is_ssh_setup ; then
	exit 0
fi

saved=$(ramtmp)/ssh-agent-vars

if [[ -f $saved ]] ; then
	cat $saved
	exit 0
fi

ssh-agent -s | tee $saved
exit 0
